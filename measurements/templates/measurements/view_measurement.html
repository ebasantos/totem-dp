<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visualizar Medição - Sistema DNP</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Menu Lateral -->
    <div class="fixed inset-y-0 left-0 w-64 bg-white shadow-lg">
        <div class="flex flex-col h-full">
            <div class="p-6">
                <h1 class="text-2xl font-bold text-gray-800">Sistema DNP</h1>
            </div>
            <nav class="flex-1 px-4">
                <a href="/" class="flex items-center px-4 py-3 text-gray-700 hover:bg-blue-50 rounded-lg mb-2">
                    <i class="fas fa-home w-6"></i>
                    <span class="ml-3">Início</span>
                </a>
                <a href="/measure" class="flex items-center px-4 py-3 text-gray-700 hover:bg-blue-50 rounded-lg mb-2">
                    <i class="fas fa-ruler w-6"></i>
                    <span class="ml-3">Medir DNP</span>
                </a>
                <a href="/history" class="flex items-center px-4 py-3 text-gray-700 bg-blue-50 rounded-lg mb-2">
                    <i class="fas fa-history w-6"></i>
                    <span class="ml-3">Histórico</span>
                </a>
                <a href="/settings" class="flex items-center px-4 py-3 text-gray-700 hover:bg-blue-50 rounded-lg">
                    <i class="fas fa-cog w-6"></i>
                    <span class="ml-3">Configurações</span>
                </a>
            </nav>
        </div>
    </div>

    <!-- Conteúdo Principal -->
    <div class="ml-64 p-8">
        <div class="max-w-4xl mx-auto">
            <div class="flex justify-between items-center mb-8">
                <h1 class="text-3xl font-bold text-gray-800">Detalhes da Medição</h1>
                <a href="/history" class="text-blue-600 hover:text-blue-800">
                    <i class="fas fa-arrow-left"></i> Voltar ao Histórico
                </a>
            </div>

            <div class="bg-white rounded-lg shadow-lg p-6">
                <div class="grid grid-cols-2 gap-6 mb-6">
                    <div>
                        <h2 class="text-lg font-semibold text-gray-700 mb-2">Informações da Medição</h2>
                        <div class="space-y-2">
                            <p><span class="font-medium">Data:</span> <span id="measurementDate"></span></p>
                            <p><span class="font-medium">Distância:</span> <span id="measurementDistance"></span> mm</p>
                            <p><span class="font-medium">Status:</span> <span id="measurementStatus"></span></p>
                            <p><span class="font-medium">Confiança:</span> <span id="measurementConfidence"></span></p>
                        </div>
                    </div>
                    <div>
                        <h2 class="text-lg font-semibold text-gray-700 mb-2">Validação</h2>
                        <div class="space-y-2">
                            <p><span class="font-medium">Validado:</span> <span id="measurementValidated"></span></p>
                            <p><span class="font-medium">Distância Validada:</span> <span id="measurementValidatedDistance"></span></p>
                        </div>
                    </div>
                </div>

                <div class="mb-6">
                    <h2 class="text-lg font-semibold text-gray-700 mb-2">Imagem da Medição</h2>
                    <div class="border rounded-lg p-4">
                        <img id="measurementImage" class="max-w-full h-auto mx-auto" src="" alt="Imagem da medição">
                    </div>
                </div>

                <div class="flex justify-end space-x-4">
                    <button onclick="validateMeasurement()" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700">
                        <i class="fas fa-check"></i> Validar Medição
                    </button>
                    <button onclick="deleteMeasurement()" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700">
                        <i class="fas fa-trash"></i> Excluir Medição
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Função para carregar os dados da medição
        function loadMeasurement() {
            const measurementId = window.location.pathname.split('/').pop();
            fetch(`/api/measurements/${measurementId}/`)
                .then(response => response.json())
                .then(data => {
                    document.getElementById('measurementDate').textContent = new Date(data.created_at).toLocaleString('pt-BR');
                    document.getElementById('measurementDistance').textContent = data.distance.toFixed(1);
                    document.getElementById('measurementStatus').textContent = data.is_validated ? 'Validado' : 'Pendente';
                    document.getElementById('measurementConfidence').textContent = (data.confidence * 100).toFixed(1) + '%';
                    document.getElementById('measurementValidated').textContent = data.is_validated ? 'Sim' : 'Não';
                    document.getElementById('measurementValidatedDistance').textContent = data.validated_distance ? data.validated_distance.toFixed(1) + ' mm' : 'Não validado';
                    document.getElementById('measurementImage').src = 'data:image/jpeg;base64,' + data.image;
                })
                .catch(error => {
                    console.error('Erro ao carregar medição:', error);
                    alert('Erro ao carregar os dados da medição');
                });
        }

        // Função para validar a medição
        function validateMeasurement() {
            const measurementId = window.location.pathname.split('/').pop();
            const validatedDistance = prompt('Digite a distância validada (em mm):');
            
            if (validatedDistance) {
                fetch(`/api/measurements/${measurementId}/validate/`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        validated_distance: parseFloat(validatedDistance)
                    })
                })
                .then(response => response.json())
                .then(data => {
                    alert('Medição validada com sucesso!');
                    loadMeasurement();
                })
                .catch(error => {
                    console.error('Erro ao validar medição:', error);
                    alert('Erro ao validar a medição');
                });
            }
        }

        // Função para excluir a medição
        function deleteMeasurement() {
            if (confirm('Tem certeza que deseja excluir esta medição?')) {
                const measurementId = window.location.pathname.split('/').pop();
                fetch(`/api/measurements/${measurementId}/`, {
                    method: 'DELETE'
                })
                .then(response => {
                    if (response.ok) {
                        alert('Medição excluída com sucesso!');
                        window.location.href = '/history';
                    } else {
                        throw new Error('Erro ao excluir medição');
                    }
                })
                .catch(error => {
                    console.error('Erro ao excluir medição:', error);
                    alert('Erro ao excluir a medição');
                });
            }
        }

        // Carrega os dados ao carregar a página
        document.addEventListener('DOMContentLoaded', loadMeasurement);
    </script>
</body>
</html> 